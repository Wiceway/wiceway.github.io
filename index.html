<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Å—Ç—É–ø–∏—Ç—å –≤ —á–∞—Ç</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º VK Bridge -->
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
        }
        
        .container {
            text-align: center;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 100%;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .chat-button {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            box-shadow: 0 4px 15px rgba(75, 108, 183, 0.3);
        }
        
        .chat-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(75, 108, 183, 0.4);
        }
        
        .chat-button:active {
            transform: translateY(0);
        }
        
        .loader {
            display: none;
            margin: 20px auto;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4b6cb7;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        .error-message {
            color: #e74c3c;
            background: #ffeaea;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .chat-button {
                padding: 16px 30px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üí¨</div>
        <h1>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É —á–∞—Ç—É</h1>
        <p class="description">
            –û–±—â–∞–π—Ç–µ—Å—å —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏, –∑–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –±—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å–µ –≤—Å–µ—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –≤ –Ω–∞—à–µ–º —É—é—Ç–Ω–æ–º —á–∞—Ç–µ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
        </p>
        
        <button id="chatButton" class="chat-button">
            <span>üí¨</span>
            <span>–í—Å—Ç—É–ø–∏—Ç—å –≤ —á–∞—Ç</span>
        </button>
        
        <div id="loader" class="loader"></div>
        
        <div id="errorMessage" class="error-message">
            –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤—Ä—É—á–Ω—É—é.
        </div>
    </div>

    <script>
        // –í–∞—à–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —á–∞—Ç
        const CHAT_INVITE_LINK = 'https://vk.me/join/AZQ1d2ZgwwIo3gu/vq5WuaCY';
        
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', function() {
            const button = document.getElementById('chatButton');
            const loader = document.getElementById('loader');
            const errorMessage = document.getElementById('errorMessage');
            
            // –ü—Ä—è—á–µ–º –ª–æ–∞–¥–µ—Ä –∏ –æ—à–∏–±–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            hideLoader();
            hideError();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ VK Bridge
            if (typeof vkBridge === 'undefined') {
                console.warn('VK Bridge –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback —Ä–µ–∂–∏–º');
                setupFallback();
            } else {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ VK Bridge
                initVKApp();
            }
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            button.addEventListener('click', function() {
                openChat();
            });
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞
            function openChat() {
                showLoader();
                hideError();
                
                if (typeof vkBridge !== 'undefined' && vkBridge.isWebView()) {
                    // –í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ VK
                    vkBridge.send('VKWebAppOpenURL', {
                        url: CHAT_INVITE_LINK,
                        target: '_blank'
                    })
                    .then(() => {
                        hideLoader();
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ VKWebAppOpenURL:', error);
                        openLinkInNewWindow();
                    });
                } else {
                    // –í –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ –µ—Å–ª–∏ VK Bridge –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                    openLinkInNewWindow();
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Å—ã–ª–∫–∏ –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
            function openLinkInNewWindow() {
                window.open(CHAT_INVITE_LINK, '_blank');
                hideLoader();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã–ª–æ—Å—å –ª–∏ –æ–∫–Ω–æ (–∑–∞—â–∏—Ç–∞ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –æ–∫–æ–Ω)
                setTimeout(() => {
                    // –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞, –≤–æ–∑–º–æ–∂–Ω–æ, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                    const isBlocked = window.closed === undefined ? false : window.closed;
                    if (isBlocked) {
                        showError();
                        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                        copyToClipboard();
                    }
                }, 1000);
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            function initVKApp() {
                vkBridge.send('VKWebAppInit', {})
                    .then(() => {
                        console.log('VK Mini App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                        // –ú–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                        return vkBridge.send('VKWebAppGetUserInfo', {});
                    })
                    .then(userInfo => {
                        console.log('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:', userInfo);
                        // –ú–æ–∂–Ω–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                        if (userInfo && userInfo.first_name) {
                            const description = document.querySelector('.description');
                            description.textContent = `–ü—Ä–∏–≤–µ—Ç, ${userInfo.first_name}! –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É —á–∞—Ç—É –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏.`;
                        }
                    })
                    .catch(error => {
                        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ fallback —Ä–µ–∂–∏–º–µ:', error);
                    });
            }
            
            // Fallback —Ä–µ–∂–∏–º (–µ—Å–ª–∏ VK Bridge –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è)
            function setupFallback() {
                console.log('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback —Ä–µ–∂–∏–º');
            }
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            function showLoader() {
                button.style.display = 'none';
                loader.style.display = 'block';
            }
            
            function hideLoader() {
                button.style.display = 'inline-flex';
                loader.style.display = 'none';
            }
            
            function showError() {
                errorMessage.style.display = 'block';
            }
            
            function hideError() {
                errorMessage.style.display = 'none';
            }
            
            // –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (–∫–∞–∫ fallback)
            function copyToClipboard() {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(CHAT_INVITE_LINK)
                        .then(() => {
                            alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞! –í—Å—Ç–∞–≤—å—Ç–µ –µ–µ –≤ –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É –±—Ä–∞—É–∑–µ—Ä–∞.');
                        })
                        .catch(err => {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏:', err);
                            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
                            const textArea = document.createElement('textarea');
                            textArea.value = CHAT_INVITE_LINK;
                            document.body.appendChild(textArea);
                            textArea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textArea);
                            alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞! –í—Å—Ç–∞–≤—å—Ç–µ –µ–µ –≤ –±—Ä–∞—É–∑–µ—Ä.');
                        });
                }
            }
        });
    </script>
</body>
</html>
